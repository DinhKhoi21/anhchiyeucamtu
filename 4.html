<!DOCTYPE html>
<html>
  <head>
    <title>4</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <meta http-equiv="Content-Security-Policy" content="frame-src 'self' https://*.firebaseapp.com https://*.firebase.com https://*.gstatic.com"/>
    <link href="resources/css/axure_rp_page.css" type="text/css" rel="stylesheet"/>
    <link href="data/styles.css" type="text/css" rel="stylesheet"/>
    <link href="files/4/styles.css" type="text/css" rel="stylesheet"/>
    <link href="files/4/custom.css" type="text/css" rel="stylesheet"/>
    <style>
      /* Hide Axure prototype elements */
      #topPanel, #leftPanel, #mainPanel { display: none !important; }
      body { margin: 0; padding: 0; }
      .ax_default_hidden { display: none !important; }

      /* Style cho nút gửi */
      #u31 {
        cursor: pointer;
        transition: background-color 0.3s;
      }
      #u31_div {
        background-color: #4CAF50 !important;
        border: none !important;
        border-radius: 4px !important;
        cursor: pointer;
      }
      #u31:hover #u31_div {
        background-color: #45a049 !important;
      }
      #u31_text {
        color: white !important;
        cursor: pointer;
      }

      /* Style cho input */
      #u35_input {
        padding: 8px !important;
        border: 1px solid #ddd !important;
        border-radius: 4px !important;
        width: 100% !important;
        box-sizing: border-box !important;
      }
      #u35_input:focus {
        outline: none !important;
        border-color: #4CAF50 !important;
        box-shadow: 0 0 5px rgba(76, 175, 80, 0.3) !important;
      }
    </style>
    <script src="resources/scripts/jquery-3.2.1.min.js"></script>
    <script src="resources/scripts/axure/axQuery.js"></script>
    <script src="resources/scripts/axure/globals.js"></script>
    <script src="resources/scripts/axutils.js"></script>
    <script src="resources/scripts/axure/annotation.js"></script>
    <script src="resources/scripts/axure/axQuery.std.js"></script>
    <script src="resources/scripts/axure/doc.js"></script>
    <script src="resources/scripts/messagecenter.js"></script>
    <script src="resources/scripts/axure/events.js"></script>
    <script src="resources/scripts/axure/recording.js"></script>
    <script src="resources/scripts/axure/action.js"></script>
    <script src="resources/scripts/axure/expr.js"></script>
    <script src="resources/scripts/axure/geometry.js"></script>
    <script src="resources/scripts/axure/flyout.js"></script>
    <script src="resources/scripts/axure/model.js"></script>
    <script src="resources/scripts/axure/repeater.js"></script>
    <script src="resources/scripts/axure/sto.js"></script>
    <script src="resources/scripts/axure/utils.temp.js"></script>
    <script src="resources/scripts/axure/variables.js"></script>
    <script src="resources/scripts/axure/drag.js"></script>
    <script src="resources/scripts/axure/move.js"></script>
    <script src="resources/scripts/axure/visibility.js"></script>
    <script src="resources/scripts/axure/style.js"></script>
    <script src="resources/scripts/axure/adaptive.js"></script>
    <script src="resources/scripts/axure/tree.js"></script>
    <script src="resources/scripts/axure/init.temp.js"></script>
    <script src="resources/scripts/axure/legacy.js"></script>
    <script src="resources/scripts/axure/viewer.js"></script>
    <script src="resources/scripts/axure/math.js"></script>
    <script src="resources/scripts/axure/jquery.nicescroll.min.js"></script>
    <script src="data/document.js"></script>
    <script src="files/4/data.js"></script>
    <script type="text/javascript">
      $axure.utils.getTransparentGifPath = function() { return 'resources/images/transparent.gif'; };
      $axure.utils.getOtherPath = function() { return 'resources/Other.html'; };
      $axure.utils.getReloadPath = function() { return 'resources/reload.html'; };
    </script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script>
      // Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyDUJQmRWBBbdF9uoVNXOGCRLgCVNxPSGlw",
        authDomain: "khongkhong12-755ec.firebaseapp.com",
        databaseURL: "https://khongkhong12-755ec-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "khongkhong12-755ec",
        storageBucket: "khongkhong12-755ec.appspot.com",
        messagingSenderId: "1011219565499",
        appId: "1:1011219565499:web:0a5c0e5d2f7c6a5c2f7c6a"
      };

      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
      const database = firebase.database();

      $(document).ready(function() {
        // Ẩn các phần tử Axure
        $('#topPanel, #leftPanel, #mainPanel').hide();
        $('.ax_default_hidden').hide();
        
        // Xóa margin và padding không cần thiết
        $('body').css({
          'margin': '0',
          'padding': '0',
          'overflow-x': 'hidden'
        });
        
        // Center the main content
        $('#u29').css({
          'position': 'absolute',
          'left': '50%',
          'transform': 'translateX(-50%)',
          'top': '20px'
        });

        // Kiểm tra kết nối Firebase
        const connectedRef = database.ref(".info/connected");
        connectedRef.on("value", (snap) => {
          if (snap.val() === true) {
            console.log("Connected to Firebase");
          } else {
            console.log("Not connected to Firebase");
          }
        });

        // Xử lý khi nhấn nút Gửi
        function sendMessage() {
          console.log('Attempting to send message...');
          
          // Lấy nội dung tin nhắn
          const message = $('#u35_input').val();
          console.log('Message content:', message);
          
          if (!message || message.trim() === '') {
            alert('Vui lòng nhập nội dung tin nhắn!');
            return;
          }

          // Vô hiệu hóa nút gửi để tránh double submit
          $('#u31, #u31_div, #u31_text').css('pointer-events', 'none');
          $('#u31_div').css('background-color', '#cccccc !important');

          // Tạo reference mới cho tin nhắn
          const newMessageRef = database.ref('messages').push();
          console.log('Created new message ref:', newMessageRef.key);

          // Chuẩn bị dữ liệu tin nhắn
          const messageData = {
            message: message.trim(),
            time: firebase.database.ServerValue.TIMESTAMP,
            status: 'new'
          };
          
          // Lưu tin nhắn vào Firebase
          newMessageRef.set(messageData)
            .then(() => {
              console.log('Message saved successfully');
              // Hiển thị thông báo thành công
              $('#u32').css('display', 'block');
              $('#u32').css('visibility', 'visible');
              $('#u33').css('display', 'block');
              $('#u33').css('visibility', 'visible');
              
              // Xóa nội dung input
              $('#u35_input').val('');
              
              // Ẩn thông báo sau 3 giây
              setTimeout(function() {
                $('#u32').css('display', 'none');
                $('#u32').css('visibility', 'hidden');
                $('#u33').css('display', 'none');
                $('#u33').css('visibility', 'hidden');
              }, 3000);
            })
            .catch((error) => {
              console.error('Error saving message:', error);
              alert('Có lỗi xảy ra khi gửi tin nhắn: ' + error.message);
            })
            .finally(() => {
              // Kích hoạt lại nút gửi
              setTimeout(() => {
                $('#u31, #u31_div, #u31_text').css('pointer-events', 'auto');
                $('#u31_div').css('background-color', '#4CAF50 !important');
              }, 1000); // Đợi 1 giây trước khi cho phép gửi lại
            });
        }

        // Chỉ gắn một sự kiện click cho nút gửi
        $('#u31').on('click', function(e) {
          e.preventDefault();
          e.stopPropagation();
          sendMessage();
        });

        // Gắn sự kiện enter cho input
        $('#u35_input').on('keypress', function(e) {
          if (e.which === 13) { // 13 là mã phím Enter
            e.preventDefault();
            sendMessage();
          }
        });

        // Test Firebase connection
        console.log('Testing Firebase connection...');
        database.ref('.info/connected').once('value')
          .then((snapshot) => {
            console.log('Firebase connection test result:', snapshot.val());
          })
          .catch((error) => {
            console.error('Firebase connection test error:', error);
          });
      });
    </script>
  </head>
  <body>
    <div id="base" class="">
      <!-- Unnamed (Group) -->
      <div id="u29" class="ax_default" data-left="65" data-top="20" data-width="300" data-height="96" layer-opacity="1">
        <!-- Unnamed (Rectangle) -->
        <div id="u30" class="ax_default heading_1">
          <div id="u30_div" class=""></div>
          <div id="u30_text" class="text ">
            <p><span>Vậy mình muốn đi đâu ta</span></p>
          </div>
        </div>

        <!-- Unnamed (Rectangle) -->
        <div id="u31" class="ax_default primary_button">
          <div id="u31_div" class=""></div>
          <div id="u31_text" class="text ">
            <p><span>Gửi</span></p>
          </div>
        </div>

        <!-- Gửi Thành Công (Dynamic Panel) -->
        <div id="u32" class="ax_default ax_default_hidden" data-label="Gửi Thành Công" style="display:none; visibility: hidden">
          <div id="u32_state0" class="panel_state" data-label="Gửi Thành Công" style="">
            <div id="u32_state0_content" class="panel_state_content">
              <!-- Unnamed (Shape) -->
              <div id="u33" class="ax_default icon ax_default_hidden" style="display:none; visibility: hidden">
                <img id="u33_img" class="img " src="images/4/u33.svg"/>
                <div id="u33_text" class="text " style="display:none; visibility: hidden">
                  <p></p>
                </div>
              </div>

              <!-- Unnamed (Rectangle) -->
              <div id="u34" class="ax_default heading_2">
                <div id="u34_div" class=""></div>
                <div id="u34_text" class="text ">
                  <p><span>Gửi Thành Công</span></p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Unnamed (Text Field) -->
        <div id="u35" class="ax_default text_field">
          <div id="u35_div" class=""></div>
          <input id="u35_input" type="text" value="" class="u35_input"/>
        </div>
      </div>
    </div>
    <script src="resources/scripts/axure/ios.js"></script>
  </body>
</html>
